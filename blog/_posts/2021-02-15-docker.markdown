---
layout: post
title: "Docker"
date: 2021-02-15 11:48:00 -0800
categories: engineering
published: true
description: Some stuff I find useful when working with Docker containers
---

Docker is a platform that lets you package applications and their dependencies into lightweight, portable containers that can run consistently across different environments. Here are some of the commands that I routinely use.

# Basic Docker commands

## Standalone containers

Build an image:
```
docker build -t alango/node-hello .
```

Run the image:
```
docker run -it 
  --rm -d -p 8080:80 
  --name hello 
  -e WHO="laura" alango/node-hello
```

"ssh" into the container:
```
docker exec -t -i 7c21fb1cad24 /bin/bash
```

Push images to Docker Hub:
```
docker tag local-image:tagname new-repo:tagname
docker push new-repo:tagname
```

Starting a shell inside the container:

    docker exec -it b403b7b43afe /bin/bash

List all containers.

    docker ps

## Docker Compose containers

Rebuild + recreate only that service (don't touch others):

```
docker compose up -d --no-deps --build <service>
```

# Running containers in the cloud

## Azure

Deploying to Azure:
```
index.docker.io
```

Create a container:
```bash
az container create --resource-group enterpos           \
    --name mycontainer                                  \
    --image mcr.microsoft.com/azuredocs/aci-helloworld  \
    --dns-name-label aci-demo-alanboy                   \
    --ports 80
```

```bash
az container show                                       \
    --resource-group enterpos                           \
    --name mycontainer                                  \
    --query "{FQDN:ipAddress.fqdn,ProvisioningState:provisioningState}" \
    --out table
```

https://docs.microsoft.com/en-us/azure/container-instances/container-instances-quickstart


### Az Cli commands
Create a container:
```
az container create 
  --resource-group enterpos 
  --name mycontainer 
  --image mcr.microsoft.com/azuredocs/aci-helloworld 
  --dns-name-label aci-demo-alanboy 
  --ports 80
```

```
az container show 
  --resource-group enterpos 
  --name mycontainer 
  --query "{FQDN:ipAddress.fqdn,ProvisioningState:provisioningState}" 
  --out table
```


## AWS
https://docs.aws.amazon.com/AmazonECS/latest/developerguide/Welcome.html
https://us-west-2.console.aws.amazon.com/ecs/home?region=us-west-2#/getStarted

https://docs.microsoft.com/en-us/azure/container-instances/container-instances-quickstart
https://docs.aws.amazon.com/AmazonECS/latest/developerguide/Welcome.html
https://us-west-2.console.aws.amazon.com/ecs/home?region=us-west-2#/getStarted


## more
docker stop: Stop a running container (send SIGTERM, and then SIGKILL after grace period) sh[...] The main process inside the container will receive SIGTERM, and after a grace period, SIGKILL. [emphasis mine]

docker kill: Kill a running container (send SIGKILL, or specified signal) [...] The main process inside the container will be sent SIGKILL, or any signal specified with option --signal. [emphasis mine]

https://www.digitalocean.com/community/tutorials/how-to-optimize-docker-images-for-production
https://docs.docker.com/develop/dev-best-practices/
